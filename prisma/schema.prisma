generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["postgresqlExtensions"]
}

datasource db {
  provider   = "postgresql"
  url        = env("DATABASE_URL")
  extensions = [uuid_ossp(map: "uuid-ossp", schema: "extensions"), vector]
}

model Taxa {
  id               Int                    @id
  scientificName   String?
  commonNames      Json?
  rank             String
  rankLevel        Int
  parentId         Int?
  embedding        Unsupported("vector")?
  embeddingContent String?
  createdAt        DateTime               @default(now()) @db.Timestamptz(6)
  updatedAt        DateTime               @default(now()) @db.Timestamptz(6)
  externalIds      ExternalID[]
  parent           Taxa?                  @relation("TaxaToTaxa", fields: [parentId], references: [id])
  children         Taxa[]                 @relation("TaxaToTaxa")

  @@map("taxa")
}

model ExternalID {
  taxaId     Int
  source     String
  externalId String
  taxa       Taxa?  @relation(fields: [taxaId], references: [id])

  @@id([taxaId, externalId])
  @@map("external_ids")
}

model SourceInaturalist {
  id            Int      @id @unique
  createdAt     DateTime @default(now()) @db.Timestamptz(6)
  taxaApiResult Json?
  updatedAt     DateTime @default(now()) @db.Timestamptz(6)

  @@map("source_inaturalist")
}
